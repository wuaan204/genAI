name: Keep Backend Awake

on:
  schedule:
    # Ch·∫°y m·ªói 10 ph√∫t
    - cron: '*/10 * * * *'
  workflow_dispatch: # Cho ph√©p ch·∫°y th·ªß c√¥ng

jobs:
  ping-backend:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Backend Health Check
        run: |
          BACKEND_URL="${{ secrets.WORKFLOW_BACKEND_URL }}"
          
          if [ -z "$BACKEND_URL" ]; then
            echo "‚ö†Ô∏è  Bi·∫øn m√¥i tr∆∞·ªùng WORKFLOW_BACKEND_URL ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh"
            echo "Vui l√≤ng th√™m bi·∫øn n√†y trong Settings > Secrets and variables > Actions"
            exit 0
          fi
          
          echo "üîÑ ƒêang ping backend: $BACKEND_URL"
          
          # G·ª≠i request GET ƒë·∫øn endpoint /health
          # -f: fail silently (kh√¥ng fail workflow n·∫øu request th·∫•t b·∫°i)
          # -s: silent mode (kh√¥ng hi·ªÉn th·ªã progress)
          # -o /dev/null: kh√¥ng hi·ªÉn th·ªã output
          # -w: timeout 30 gi√¢y
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 "$BACKEND_URL" || echo "000")
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ Backend ƒëang ho·∫°t ƒë·ªông (HTTP $HTTP_CODE)"
          else
            echo "‚ö†Ô∏è  Backend kh√¥ng ph·∫£n h·ªìi (HTTP $HTTP_CODE ho·∫∑c timeout)"
            echo "ƒêi·ªÅu n√†y kh√¥ng l√†m fail workflow, backend s·∫Ω ƒë∆∞·ª£c ping l·∫°i sau 10 ph√∫t"
          fi

